# Rust å¾ªç¯å¼•ç”¨æ·±å…¥å­¦ä¹ ç¤ºä¾‹

[![Rust](https://img.shields.io/badge/rust-1.70+-orange.svg)](https://www.rust-lang.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Documentation](https://docs.rs/cycles/badge.svg)](https://docs.rs/cycles)

è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºå­¦ä¹  Rust ä¸­å¾ªç¯å¼•ç”¨ï¼ˆReference Cyclesï¼‰å’Œå†…å­˜ç®¡ç†è€Œè®¾è®¡çš„ç»¼åˆå­¦ä¹ é¡¹ç›®ã€‚é€šè¿‡è¯¦ç»†çš„ç¤ºä¾‹ã€ä¸­æ–‡æ³¨é‡Šå’Œå®é™…åº”ç”¨åœºæ™¯ï¼Œå¸®åŠ©æ‚¨æ·±å…¥ç†è§£ Rust æ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨å’Œå†…å­˜å®‰å…¨æœºåˆ¶ã€‚

## ğŸ“š ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [å­¦ä¹ ç›®æ ‡](#å­¦ä¹ ç›®æ ‡)
- [å‰ç½®çŸ¥è¯†](#å‰ç½®çŸ¥è¯†)
- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [è¿è¡Œç¤ºä¾‹](#è¿è¡Œç¤ºä¾‹)
- [è¯¦ç»†ç¤ºä¾‹è¯´æ˜](#è¯¦ç»†ç¤ºä¾‹è¯´æ˜)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é™·é˜±](#å¸¸è§é™·é˜±)
- [ç›¸å…³èµ„æº](#ç›¸å…³èµ„æº)
- [è´¡çŒ®æŒ‡å—](#è´¡çŒ®æŒ‡å—)

## ğŸ¯ é¡¹ç›®ç®€ä»‹

Rust çš„æ‰€æœ‰æƒç³»ç»Ÿç¡®ä¿äº†å†…å­˜å®‰å…¨ï¼Œä½†åœ¨ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ—¶ï¼Œå¾ªç¯å¼•ç”¨å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚æœ¬é¡¹ç›®é€šè¿‡5ä¸ªæ¸è¿›å¼çš„ç¤ºä¾‹ï¼Œä»åŸºç¡€çš„å¾ªç¯å¼•ç”¨é—®é¢˜åˆ°å¤æ‚çš„å®é™…åº”ç”¨åœºæ™¯ï¼Œå…¨é¢å±•ç¤ºäº†å¦‚ä½•è¯†åˆ«ã€é¢„é˜²å’Œè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚

### ç‰¹è‰²äº®ç‚¹

- ğŸ“– **è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š** - 800+ è¡Œè¯¦ç»†è§£é‡Š
- ğŸ¯ **æ¸è¿›å¼å­¦ä¹ è·¯å¾„** - ä»ç®€å•åˆ°å¤æ‚
- ğŸ’¡ **å®é™…åº”ç”¨åœºæ™¯** - å›¾ç»“æ„ã€è§‚å¯Ÿè€…æ¨¡å¼ç­‰
- ğŸ”§ **å®Œæ•´è§£å†³æ–¹æ¡ˆ** - Rcã€Weakã€RefCell çš„ç»¼åˆåº”ç”¨
- ğŸ“‹ **æœ€ä½³å®è·µæŒ‡å—** - é¿å…å†…å­˜æ³„æ¼çš„å®ç”¨å»ºè®®

## ğŸ“ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬é¡¹ç›®ï¼Œæ‚¨å°†å­¦ä¼šï¼š

- âœ… ç†è§£ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨åŠå…¶å±å®³
- âœ… æŒæ¡ Rc<T> æ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨
- âœ… å­¦ä¼šä½¿ç”¨ Weak<T> æ‰“ç ´å¾ªç¯å¼•ç”¨
- âœ… ç†è§£ RefCell<T> çš„å†…éƒ¨å¯å˜æ€§
- âœ… è¯†åˆ«å’Œé¢„é˜²å†…å­˜æ³„æ¼
- âœ… åº”ç”¨æœ€ä½³å®è·µè®¾è®¡æ•°æ®ç»“æ„
- âœ… å¤„ç†å¤æ‚çš„å®é™…åº”ç”¨åœºæ™¯

## ğŸ“‹ å‰ç½®çŸ¥è¯†

åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œå»ºè®®æ‚¨å·²ç»äº†è§£ï¼š

- Rust åŸºç¡€è¯­æ³•å’Œæ‰€æœ‰æƒæ¦‚å¿µ
- å‡½æ•°ã€ç»“æ„ä½“å’Œæšä¸¾çš„ä½¿ç”¨
- åŸºæœ¬çš„é”™è¯¯å¤„ç†æœºåˆ¶

å¦‚æœæ‚¨æ˜¯ Rust åˆå­¦è€…ï¼Œå»ºè®®å…ˆé˜…è¯» [Rust Book](https://doc.rust-lang.org/book/) çš„å‰å‡ ç« ã€‚

## ğŸ§  æ ¸å¿ƒæ¦‚å¿µ

### å¾ªç¯å¼•ç”¨ (Reference Cycles)

å¾ªç¯å¼•ç”¨æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªå¼•ç”¨ç›¸äº’æŒ‡å‘ï¼Œå½¢æˆé—­ç¯çš„æƒ…å†µã€‚åœ¨ Rust ä¸­ï¼Œè¿™ä¼šå¯¼è‡´å¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸ºé›¶ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚

```rust
// ç®€å•çš„å¾ªç¯å¼•ç”¨ç¤ºä¾‹
struct Node {
    value: i32,
    next: RefCell<Option<Rc<Node>>>,
}
```

### æ™ºèƒ½æŒ‡é’ˆç±»å‹

| ç±»å‹ | ç”¨é€” | ç‰¹ç‚¹ |
|------|------|------|
| `Rc<T>` | å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ | å…è®¸å¤šä¸ªæ‰€æœ‰æƒï¼Œçº¿ç¨‹ä¸å®‰å…¨ |
| `Weak<T>` | å¼±å¼•ç”¨æŒ‡é’ˆ | ä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå¯å‡çº§ä¸ºå¼ºå¼•ç”¨ |
| `RefCell<T>` | å†…éƒ¨å¯å˜æ€§ | è¿è¡Œæ—¶æ£€æŸ¥å€Ÿç”¨è§„åˆ™ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
cycles/
â”œâ”€â”€ Cargo.toml              # é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ src/
    â””â”€â”€ main.rs             # ä¸»è¦ç¤ºä¾‹ä»£ç ï¼ˆ632è¡Œï¼‰
```

### ä»£ç ç»„ç»‡

é¡¹ç›®ä»£ç æŒ‰ä»¥ä¸‹æ–¹å¼ç»„ç»‡ï¼š

1. **åŸºç¡€ç»“æ„å®šä¹‰** - å„ç§èŠ‚ç‚¹ç±»å‹
2. **æ¼”ç¤ºå‡½æ•°** - 5ä¸ªå®Œæ•´çš„å­¦ä¹ åœºæ™¯
3. **ä¸»å‡½æ•°** - ç¨‹åºå…¥å£å’Œæ€»ç»“

## ğŸš€ è¿è¡Œç¤ºä¾‹

### å®‰è£… Rust

é¦–å…ˆç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£… Rustï¼š

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

### å…‹éš†å’Œè¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/ultimate_rust.git
cd ultimate_rust/cycles

# è¿è¡Œç¤ºä¾‹
cargo run

# æˆ–è€…ç¼–è¯‘åè¿è¡Œ
cargo build
./target/debug/cycles
```

### é¢„æœŸè¾“å‡º

è¿è¡Œç¨‹åºå°†çœ‹åˆ°å®Œæ•´çš„æ¼”ç¤ºè¾“å‡ºï¼ŒåŒ…æ‹¬ï¼š

```
=== Rust å¾ªç¯å¼•ç”¨æ·±å…¥å­¦ä¹ ç¤ºä¾‹ ===

ğŸ”´ 1. å¾ªç¯å¼•ç”¨é—®é¢˜æ¼”ç¤º:
   åˆ›å»ºä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œè§‚å¯Ÿå†…å­˜æ³„æ¼é—®é¢˜
   ...

ğŸŸ¢ 2. ä½¿ç”¨å¼±å¼•ç”¨è§£å†³å¾ªç¯å¼•ç”¨:
   ä½¿ç”¨ Weak<T> æ‰“ç ´å¾ªç¯å¼•ç”¨ï¼Œè®©å†…å­˜èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾
   ...

ğŸ”µ 3. å›¾ç»“æ„å¾ªç¯å¼•ç”¨å¤„ç†:
   å¤„ç†å›¾ç»“æ„ä¸­æ›´å¤æ‚çš„å¾ªç¯å¼•ç”¨åœºæ™¯
   ...

ğŸŸ¡ 4. è§‚å¯Ÿè€…æ¨¡å¼å¾ªç¯å¼•ç”¨å¤„ç†:
   åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ä½¿ç”¨å¼±å¼•ç”¨é¿å…å†…å­˜æ³„æ¼
   ...

ğŸŸ£ 5. å¼•ç”¨è®¡æ•°å®é™…æ¼”ç¤º:
   æ·±å…¥ç†è§£ Rc å’Œ Weak çš„å¼•ç”¨è®¡æ•°æœºåˆ¶
   ...

=== å¾ªç¯å¼•ç”¨å­¦ä¹ æ€»ç»“ ===
ğŸ¯ æ ¸å¿ƒæ¦‚å¿µå›é¡¾:
ğŸ’¡ æœ€ä½³å®è·µ:
ğŸ”§ å®é™…åº”ç”¨:
```

## ğŸ“– è¯¦ç»†ç¤ºä¾‹è¯´æ˜

### 1. å¾ªç¯å¼•ç”¨é—®é¢˜æ¼”ç¤º (`demonstrate_cycle_problem`)

**ç›®æ ‡**: å±•ç¤ºå¾ªç¯å¼•ç”¨å¦‚ä½•å¯¼è‡´å†…å­˜æ³„æ¼

**ç»“æ„ä½“**: `CircularListNode`
- ä½¿ç”¨ `Rc<Node>` å’Œ `RefCell<Option<Rc<Node>>>`
- åˆ›å»º Aâ†’B å’Œ Bâ†’A çš„å¾ªç¯å¼•ç”¨
- è§‚å¯Ÿå†…å­˜æ³„æ¼ç°è±¡

**å…³é”®ä»£ç **:
```rust
let tail_node = CircularListNode::create(1);
let head_node = CircularListNode::create(2);

// å»ºç«‹å¾ªç¯å¼•ç”¨
*head_node.next_node.borrow_mut() = Some(tail_node.clone());
*tail_node.next_node.borrow_mut() = Some(head_node.clone());
```

### 2. å¼±å¼•ç”¨è§£å†³æ–¹æ¡ˆ (`demonstrate_weak_reference_solution`)

**ç›®æ ‡**: ä½¿ç”¨ `Weak<T>` æ‰“ç ´å¾ªç¯å¼•ç”¨

**ç»“æ„ä½“**: `SafeListNode`
- å¼ºå¼•ç”¨ç”¨äºæ‰€æœ‰æƒå…³ç³»
- å¼±å¼•ç”¨ç”¨äºéæ‰€æœ‰æƒå…³ç³»
- æšä¸¾ `NodeReference` ç®¡ç†å¼•ç”¨ç±»å‹

**å…³é”®ä»£ç **:
```rust
// å¼ºå¼•ç”¨è¿æ¥
head_node.link_to_strong(tail_node.clone());

// å¼±å¼•ç”¨æ‰“ç ´å¾ªç¯
tail_node.link_to_weak(&head_node);
```

### 3. å›¾ç»“æ„å¤„ç† (`demonstrate_graph_cycles`)

**ç›®æ ‡**: å¤„ç†å¤æ‚å›¾æ•°æ®ç»“æ„ä¸­çš„å¾ªç¯å¼•ç”¨

**ç»“æ„ä½“**: `NetworkGraphNode`
- é‚»å±…èŠ‚ç‚¹ä½¿ç”¨å¼ºå¼•ç”¨
- çˆ¶èŠ‚ç‚¹ä½¿ç”¨å¼±å¼•ç”¨
- æ¨¡æ‹Ÿå®é™…å›¾ç»“æ„åœºæ™¯

**åº”ç”¨åœºæ™¯**:
- ç¤¾äº¤ç½‘ç»œå…³ç³»
- è½¯ä»¶ä¾èµ–å›¾
- è·¯å¾„ç½‘ç»œ

### 4. è§‚å¯Ÿè€…æ¨¡å¼ (`demonstrate_observer_pattern`)

**ç›®æ ‡**: åœ¨è®¾è®¡æ¨¡å¼ä¸­é¿å…å¾ªç¯ä¾èµ–

**ç»“æ„ä½“**: `EventPublisher` å’Œ `EventSubscriber`
- å‘å¸ƒè€…æŒæœ‰å¼±å¼•ç”¨åˆ—è¡¨
- è®¢é˜…è€…å¯å®‰å…¨é”€æ¯
- è‡ªåŠ¨æ¸…ç†å¤±æ•ˆå¼•ç”¨

**å®é™…åº”ç”¨**:
- GUI äº‹ä»¶ç³»ç»Ÿ
- æ¶ˆæ¯é˜Ÿåˆ—
- çŠ¶æ€ç®¡ç†

### 5. å¼•ç”¨è®¡æ•°æœºåˆ¶ (`demonstrate_reference_counting`)

**ç›®æ ‡**: æ·±å…¥ç†è§£å¼•ç”¨è®¡æ•°å·¥ä½œåŸç†

**æ¼”ç¤ºå†…å®¹**:
- åˆ›å»ºå¤šä¸ªå¼ºå¼•ç”¨è§‚å¯Ÿè®¡æ•°å˜åŒ–
- åˆ›å»ºå¼±å¼•ç”¨ä¸å½±å“å¼•ç”¨è®¡æ•°
- å¼±å¼•ç”¨å‡çº§æœºåˆ¶
- å¼•ç”¨é‡Šæ”¾è¿‡ç¨‹

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é¢„é˜²å¾ªç¯å¼•ç”¨

```rust
// âœ… å¥½çš„åšæ³•ï¼šæ˜ç¡®æ‰€æœ‰æƒå…³ç³»
struct Child {
    parent: Weak<Parent>,  // å­èŠ‚ç‚¹å¯¹çˆ¶èŠ‚ç‚¹ä½¿ç”¨å¼±å¼•ç”¨
    data: String,
}

// âŒ é¿å…ï¼šåŒå‘å¼ºå¼•ç”¨
struct BadChild {
    parent: Rc<Parent>,    // å¯èƒ½é€ æˆå¾ªç¯å¼•ç”¨
    data: String,
}
```

### 2. ä½¿ç”¨æ¨¡å¼

```rust
// åˆ›å»ºå¼±å¼•ç”¨
let weak_ref = Rc::downgrade(&strong_ref);

// å®‰å…¨å‡çº§
if let Some(strong_ref) = weak_ref.upgrade() {
    // ä½¿ç”¨å¼ºå¼•ç”¨
    println!("æ•°æ®: {}", strong_ref.data);
} else {
    // å¯¹è±¡å·²è¢«é”€æ¯
    println!("å¼•ç”¨å·²å¤±æ•ˆ");
}
```

### 3. å®šæœŸæ¸…ç†

```rust
impl EventPublisher {
    fn cleanup_expired_references(&self) {
        self.subscribers.borrow_mut()
            .retain(|weak| weak.upgrade().is_some());
    }
}
```

## âš ï¸ å¸¸è§é™·é˜±

### 1. å¿˜è®°ä½¿ç”¨å¼±å¼•ç”¨

```rust
// âŒ å±é™©ï¼šå¯èƒ½é€ æˆå†…å­˜æ³„æ¼
struct Node {
    children: Vec<Rc<Node>>,
    parent: Option<Rc<Node>>,  // åº”è¯¥ä½¿ç”¨ Weak<Node>
}
```

### 2. ä¸æ£€æŸ¥å¼±å¼•ç”¨æœ‰æ•ˆæ€§

```rust
// âŒ å±é™©ï¼šå¯èƒ½å¯¼è‡´ panic
for weak_ref in weak_references {
    let strong = weak_ref.upgrade().unwrap();  // å¯èƒ½ä¸º None
    strong.do_something();
}

// âœ… å®‰å…¨ï¼šæ£€æŸ¥å‡çº§ç»“æœ
for weak_ref in weak_references {
    if let Some(strong) = weak_ref.upgrade() {
        strong.do_something();
    }
}
```

### 3. è¿‡åº¦ä½¿ç”¨ Rc

```rust
// âŒ ä¸å¿…è¦ï¼šå¢åŠ å¤æ‚æ€§
fn process(data: Rc<String>) {
    println!("{}", data);
}

// âœ… æ›´å¥½ï¼šä½¿ç”¨å¼•ç”¨
fn process(data: &str) {
    println!("{}", data);
}
```

## ğŸ“š ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£

- [Rust Book - æ™ºèƒ½æŒ‡é’ˆ](https://doc.rust-lang.org/book/ch15-00-smart-pointers.html)
- [Rust Book - å¾ªç¯å¼•ç”¨](https://doc.rust-lang.org/book/ch15-06-reference-cycles.html)
- [Rc<T> æ–‡æ¡£](https://doc.rust-lang.org/std/rc/struct.Rc.html)
- [Weak<T> æ–‡æ¡£](https://doc.rust-lang.org/std/rc/struct.Weak.html)
- [RefCell<T> æ–‡æ¡£](https://doc.rust-lang.org/std/cell/struct.RefCell.html)

### å­¦ä¹ èµ„æº

- [Rust by Example - Rc](https://doc.rust-lang.org/rust-by-example/rc.html)
- [Rust å†…å­˜ç®¡ç†æŒ‡å—](https://doc.rust-lang.org/nomicon/)
- [Rust æ™ºèƒ½æŒ‡é’ˆè¯¦è§£](https://github.com/rust-lang/rust/blob/master/src/liballoc/rc.rs)

### ç›¸å…³å·¥å…·

- `cargo check` - å¿«é€Ÿæ£€æŸ¥ä»£ç 
- `cargo clippy` - ä»£ç è´¨é‡æ£€æŸ¥
- `cargo doc` - ç”Ÿæˆæ–‡æ¡£

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿å¯¹é¡¹ç›®åšå‡ºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

### è´¡çŒ®ç±»å‹

- ğŸ› Bug ä¿®å¤
- ğŸ“ æ–‡æ¡£æ”¹è¿›
- âœ¨ æ–°åŠŸèƒ½æ·»åŠ 
- ğŸ¨ ä»£ç ä¼˜åŒ–
- âš¡ æ€§èƒ½æ”¹è¿›

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ Rust ç¤¾åŒºå’Œæ‰€æœ‰ä¸º Rust ç”Ÿæ€ç³»ç»Ÿåšå‡ºè´¡çŒ®çš„å¼€å‘è€…ã€‚ç‰¹åˆ«æ„Ÿè°¢ï¼š

- [Rust Language Team](https://www.rust-lang.org/team.html)
- æ‰€æœ‰å‚ä¸ [Rust Book](https://doc.rust-lang.org/book/) ç¼–å†™çš„ä½œè€…
- ä¸º [Rust by Example](https://doc.rust-lang.org/rust-by-example/) åšå‡ºè´¡çŒ®çš„ç¤¾åŒºæˆå‘˜

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- ğŸ“§ Email: your-email@example.com
- ğŸ› Issues: [GitHub Issues](https://github.com/your-repo/ultimate_rust/issues)
- ğŸ’¬ Discussions: [GitHub Discussions](https://github.com/your-repo/ultimate_rust/discussions)

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼**